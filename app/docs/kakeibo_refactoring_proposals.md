# 家計簿機能のリファクタリング提案

このドキュメントでは、家計簿機能のリファクタリングの機会について概説します。

## 1. 入力フォーム

- **現状:** `Input` ディレクトリには、同様のロジックと構造を持つ複数の入力コンポーネントが含まれており、コードの重複が見られます。`PurchaseInput.tsx` のリファクタリングから着手しました。
- **試み:** 汎用的な入力コンポーネント `GenericInputForm.tsx` を作成し、`PurchaseInput.tsx` の入力フォームをこの汎用コンポーネントに置き換えることを試みました。
- **結果:** `PurchaseInput.tsx` の主要な入力フィールドを `GenericInputForm` に置き換えることは概ね成功しましたが、TypeScriptのエラーが解消されませんでした。特に、`CategorySelector` と `MethodSelector` コンポーネントとの型互換性の問題が解決できませんでした。また、`replace_in_file` ツールが期待どおりに動作せず、ファイル編集作業に困難が生じています。
- **課題:**
    - `GenericInputForm` とカスタムセレクターコンポーネント (`CategorySelector`, `MethodSelector`) の型定義の不整合。
    - `replace_in_file` ツールの動作が不安定で、ファイル編集が困難。
- **今後の提案:**
    - `GenericScheduleInputForm.tsx` を作成し、`InputPurchaseScheduleType` に特化した汎用入力フォームを実装する (試行中)。
    - 状態管理ライブラリ (Zustand, Jotai) の導入を検討し、コンテキストAPI の複雑さを軽減する。
    - `replace_in_file` ツールの問題を調査し、必要であれば別のファイル編集方法を検討する。
- **利点:**
    - コードの重複の削減
    - 保守性の向上
    - 柔軟性の向上

## 2. 資産管理

- **課題:** 資産関連のロジックとデータ処理が、`Asset` ディレクトリのUIコンポーネントと密接に結合している可能性があります。
- **提案:** 資産データとロジックを管理するための専用のサービスまたはフックを作成します。このサービス/フックは、資産データのフェッチ、更新、および検証を処理する必要があります。
- **利点:**
    - 関心の分離
    - テスト可能性の向上
    - 再利用性の向上

## 3. 購入テーブル

- **課題:** `PurchasesTable` ディレクトリには、ページネーション、ソート、フィルタリングなどの機能が不足している可能性があり、大規模なデータセットの管理が困難になっています。
- **提案:** ページネーション、ソート、フィルタリングを実装して、多数の購入を処理する際のユーザーエクスペリエンスを向上させます。
- **利点:**
    - ユーザーエクスペリエンスの向上
    - データ管理の強化

## 4. 画面パーツ

- **課題:** `ScreenParts` ディレクトリのコンポーネントの目的と責任が明確でない可能性があります。
- **提案:** `ScreenParts` ディレクトリのコンポーネントを確認し、明確な責任があることを確認します。複雑すぎるコンポーネントや、目的が不明確なコンポーネントをリファクタリングします。
- **利点:**
    - コードの明確さの向上
    - 再利用性の向上

## 5. 家計簿スキーマ

- **課題:** `KakeiboSchemas.ts` のデータスキーマが古くなっているか、現在のデータ構造を正確に反映していない可能性があります。
- **提案:** `KakeiboSchemas.ts` のデータスキーマを確認し、必要に応じて更新します。コード生成ツールを使用して、スキーマから型を自動的に生成することを検討してください。
- **利点:**
    - データ整合性の向上
    - 型エラーの削減

## 6. コンテキスト

- **課題:** `app/src/components/Context` の複数のコンテキストが、複雑な状態管理につながる可能性があります。
- **提案:** 関連するコンテキストを統合するか、ZustandやJotaiなどの状態管理ライブラリを使用して、状態管理を簡素化します。
- **利点:**
    - 状態管理の簡素化
    - パフォーマンスの向上
